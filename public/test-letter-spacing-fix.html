<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Spacing Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-step {
            margin: 10px 0;
            padding: 10px;
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
        }
        .success {
            background: #f0fdf4;
            border-left-color: #22c55e;
        }
        .error {
            background: #fef2f2;
            border-left-color: #ef4444;
        }
        .code {
            background: #f3f4f6;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            margin: 8px 0;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .iframe-container {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ Letter Spacing Fix Test</h1>
        <p>This test verifies that the letter spacing functionality works correctly for text objects placed within layout rectangles.</p>
        
        <div class="test-step">
            <h3>ğŸ“‹ Test Steps:</h3>
            <ol>
                <li>Open the design editor below</li>
                <li>Click the "Layout Tool" button to create a layout rectangle</li>
                <li>Draw a layout rectangle on the canvas</li>
                <li>Add some text to the canvas</li>
                <li>Copy the text (Ctrl+C or Copy button)</li>
                <li>Select the layout rectangle</li>
                <li>Paste the text (Ctrl+V or Paste button)</li>
                <li>Select the pasted text inside the layout rectangle</li>
                <li><strong>Verify that the Letter Spacing control is enabled and functional</strong></li>
            </ol>
        </div>
        
        <div class="test-step">
            <h3>ğŸ¯ Expected Behavior:</h3>
            <ul>
                <li>The Letter Spacing slider should be <strong>enabled</strong> (not grayed out)</li>
                <li>Moving the slider should change the letter spacing of the text</li>
                <li><strong>ğŸ”§ CRITICAL FIX:</strong> The text should maintain its shape-based fitting within the layout rectangle</li>
                <li><strong>ğŸ”§ NEW:</strong> Text should not overflow outside the layout rectangle when letter spacing changes</li>
                <li><strong>ğŸ”§ NEW:</strong> The text should automatically rescale to fit within the rectangle bounds</li>
                <li>Console should show debug messages about letter spacing control being enabled</li>
                <li>Console should show messages about pixel-perfect bounds recalculation</li>
            </ul>
        </div>
        
        <div class="test-step">
            <h3>ğŸ” Debug Information:</h3>
            <p>Open the browser's Developer Tools (F12) and check the Console tab for debug messages:</p>
            <div class="code">
                ğŸ”§ setControlsDisabled called: { isDisabled: false, ... }<br>
                ğŸ”§ Letter spacing control in setControlsDisabled: { disabled: false, ... }<br>
                ğŸ”§ Letter spacing control enabled for text object: { usePixelPerfectFitting: true, ... }<br>
                ğŸ”§ PASTE DEBUG: Text pasted into layout rectangle with pixel-perfect fitting: { ... }<br>
                <strong>ğŸ”§ LETTER SPACING FIX: Recalculating pixel-perfect bounds due to letter spacing change</strong><br>
                <strong>ğŸ”§ Old bounds: { width: ..., height: ... }</strong><br>
                <strong>ğŸ”§ New bounds: { width: ..., height: ... }</strong><br>
                <strong>ğŸ”§ Recalculated scale: { newScale: ... }</strong>
            </div>
        </div>
        
        <button onclick="openDesignEditor()">ğŸš€ Open Design Editor in New Tab</button>
        <button onclick="refreshIframe()">ğŸ”„ Refresh Editor</button>
        <button onclick="showConsoleInstructions()">ğŸ“ Show Console Instructions</button>
    </div>
    
    <div class="iframe-container">
        <iframe id="editorFrame" src="design-editor.html"></iframe>
    </div>
    
    <div class="test-container">
        <h3>ğŸ› Troubleshooting:</h3>
        <div class="test-step">
            <strong>If the letter spacing control is still disabled:</strong>
            <ul>
                <li>Check the browser console for any JavaScript errors</li>
                <li>Verify that the debug messages are appearing</li>
                <li>Try refreshing the page and repeating the test</li>
                <li>Ensure you're selecting the text object (not the layout rectangle)</li>
            </ul>
        </div>
    </div>

    <script>
        function openDesignEditor() {
            window.open('design-editor.html', '_blank');
        }
        
        function refreshIframe() {
            document.getElementById('editorFrame').src = 'design-editor.html?' + Date.now();
        }
        
        function showConsoleInstructions() {
            alert(`To view debug messages:
1. Press F12 to open Developer Tools
2. Click on the "Console" tab
3. Perform the test steps
4. Look for messages starting with ğŸ”§

The fix adds specific logging to help track the letter spacing control state.`);
        }
        
        // Auto-refresh iframe every 30 seconds to pick up changes during development
        setInterval(() => {
            console.log('Auto-refreshing editor iframe...');
            refreshIframe();
        }, 30000);
    </script>
</body>
</html>
